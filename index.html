<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>A Decade of Terrorism</title>
  <link href="http://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
    <style>
            h1,h2 {
                position: absolute;
                left: 20px;
                top: 10px;
                font-size: 2em;
                font-weight: 100;
                color: #005DAA;
            }
            h2 {
                top: 60px;
                font-size: 1.2em;
            }
            #map {
                width: 900px;
                height: 600px;
                margin: 10px auto;
                border: 2px solid #d3d3d3;
            }
            body {
                padding: 0;
                margin: 0;
                background: whitesmoke;
                font-family: Raleway, sans-serif;
            }
            .countries {
                stroke: white;
                fill: steelblue;
            }
            .gdp {
                fill: yellow;
            }

      </style>
  </head>
  <body>

      <div id="map"></div>
      <h1>A Decade of Terrorism</h1>
      <h2></h2>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
      <script src="https://d3js.org/d3-array.v1.min.js"></script>
      <script src="https://d3js.org/d3-geo.v1.min.js"></script>
      <script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/0.9.0/simple_statistics.min.js"></script>

      <script>

        var width = 900,
            height = 600;

        var svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        var projection = d3.geoRobinson()
            .center([4, 0.0])
            .scale(180)
            .translate([width/2, height/2]);

        var geoPath = d3.geo.path()
            .projection(projection);

        queue()
            .defer(d3.json, "data/countries_geo.json")
            .defer(d3.csv, "data/mil_xpnd.csv")
            .await(makeMap);

      function makeMap(error, countries, perOfGdp) {

        var dataArray = []; // empty array

        perOfGdp.forEach(function(country) {
            if(Number(country['2000'])) {  // if can be converted to number
                dataArray.push(Number(country['2000']))  // push to an array
            }
        });

        // console.log(dataArray) // dataArray with only numbers

        var breaks = ss.jenks(dataArray, 4);  // the breaks

        // console.log(breaks)

        breaks.shift();
        breaks.pop();

        var colors = ["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"];


        // loop through all the countries
        countries.features.map(function(country) {

            // shortcut for the country id
            var countryId = country.id;

            // loop through the CSV data array
            perOfGdp.map(function(countryData) {

                // if country code id and CSV code match
                if(countryId === countryData['Country Code']) {

                    // replace country props with CSV data
                    country.properties = countryData;
                }

            })

        });

        // verify that CSV data is bound to countries here
        // console.log(countries)

        var jenks = d3.scale.threshold()
            .domain(breaks)
            .range(colors);

        svg.append("g")
            .selectAll("path")
            .data(countries.features)
            .enter()
            .append("path")
            .attr("d", geoPath)
            .attr("class", "countries")
            .attr('fill', function(d) {
                // you have access to each country's data and props here!
                console.log(d)
            })


      } // end of makeMap()

      </script>
  </body>
</html>
